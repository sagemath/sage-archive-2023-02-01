#!/bin/sh
#
#  sage-spkg-info SPKG
#  Format information about a Sage package
#
#  Assumes SAGE_ROOT is set
PKG_BASE=$1
PKG_SCRIPTS="$SAGE_ROOT/build/pkgs/$PKG_BASE"
for ext in rst txt; do
    SPKG_FILE="$PKG_SCRIPTS/SPKG.$ext"
    if [ -f "$SPKG_FILE" ]; then
        cat "$SPKG_FILE"
        break
    fi
done
if [ -r "$PKG_SCRIPTS/type" ] ; then
    echo
    echo "Type"
    echo "----"
    echo
    cat "$PKG_SCRIPTS/type"
    echo
fi
echo
echo "Version Information"
echo "-------------------"
echo
for a in package-version.txt requirements.txt install-requires.txt; do
    if [ -f "$PKG_SCRIPTS"/"$a" ]; then
        echo "$a::"
        echo
        sed 's/^/    /' "$PKG_SCRIPTS/$a"
        echo
    fi
done
echo "Equivalent System Packages"
echo "--------------------------"
echo
PKG_DISTROS="$PKG_SCRIPTS"/distros
for system_package_file in "$PKG_DISTROS"/*.txt; do
    if [ -f "$system_package_file" ]; then
        system=$(basename "$system_package_file" .txt)
        system_packages="$(echo $(sed 's/#.*//;' $system_package_file))"
        case $system in
            debian)
                # Generic
                echo "Debian/Ubuntu:"
                ;;
            fedora)
                # Generic
                echo "Fedora/Redhat/CentOS:"
                ;;
            *)
                echo "$system:"
                ;;
        esac
        if [ -n "$OUTPUT_RST" ]; then
            echo
            echo ".. CODE-BLOCK:: bash"
            echo
        fi
        sage-print-system-package-command $system --prompt='    $ ' --sudo install $system_packages
        if [ -n "$OUTPUT_RST" ]; then
            echo
        fi
    fi
done
if [ -z "$system" ]; then
    echo "(none known)"
else
    echo
    if [ -f "$PKG_SCRIPTS"/spkg-configure.m4 ]; then
        echo "If the system package is installed, ./configure will check whether it can be used."
    else
        echo "However, these system packages will not be used for building Sage"
        echo "because spkg-configure.m4 has not been written for this package;"
        echo "see https://trac.sagemath.org/ticket/27330"
    fi
fi
echo
