# $Id: Makefile.in,v 1.11 2003/04/09 13:39:11 Singular Exp $
#################################################
SHELL		= /bin/sh
RM		= -rm -f
#################################################
TARGETNAME		= @targetname@
LIBFACNAME		= @libfac_name@
LIBFACVERSION		= @libfac_version@
LIBFACDATE		= @libfac_date@
LIBFACAUTHOR		= @libfac_author@
LIBFACNAME		= @libfac@
SINGLIBFACNAME		= @libsingfac@
LIBFACNAME-G		= @libfac_g@
SINGLIBFACNAME-G	= @libsingfac_g@
LIBFACINCLUDE		= @factorH@
#################################################
##
## various paths
##
srcdir		= @srcdir@
prefix 		= @prefix@
exec_prefix	= @exec_prefix@
libdir 		= @libdir@
includedir	= @includedir@

##
## various programs
##
AR		= @AR@ cr
RANLIB		= @RANLIB@
CXX		= @CXX@
INSTALL		= ./install-sh -c
INSTALL_DATA	= ${INSTALL} -m 644
INSTALL_PROGRAM = ${INSTALL}
MKINSTALLDIRS	= ./mkinstalldirs

##
## compiler and linker options
##
CXXFLAGS	= @CXXFLAGS@
CXXTEMPLFLAGS	= @CXXTEMPLFLAGS@
CPPFLAGS	= -I${srcdir}/factor -I${srcdir}/charset -I${srcdir} @CPPFLAGS@
DEFS		= @DEFS@
LDFLAGS		= @LDFLAGS@
LIBS		= -lfac -lcf -lcfmem -lgmp @LIBS@

##
## src and objects
##

FACTORSRC1 =	factor/SqrFree.cc factor/Factor.cc \
		factor/MVMultiHensel.cc factor/Truefactor.cc \
		factor/helpstuff.cc  factor/debug.cc factor/version.cc \
		factor/homogfactor.cc
FACTORSRC2 =	factor/tmpl_inst.cc
FACTORSRC = 	$(FACTORSRC2) $(FACTORSRC1)

CHARSETSRC1 =	charset/csutil.cc charset/charset.cc charset/reorder.cc
CHARSETSRC = 	$(CHARSETSRC1)

FACTORINCL =	factor/Factor.h factor/MVMultiHensel.h factor/Truefactor.h \
		factor/tmpl_inst.h factor/SqrFree.h factor/helpstuff.h \
		factor/debug.h factor/timing.h factor/homogfactor.h \
                factor/interrupt.h
CHARSETINCL =	charset/csutil.h charset/charset.h charset/reorder.h \
		charset/alg_factor.h charset/algfactor.h

OPTFACTOROBJ1 =	OPTOBJ/SqrFree.o OPTOBJ/Factor.o OPTOBJ/MVMultiHensel.o \
		OPTOBJ/Truefactor.o OPTOBJ/helpstuff.o OPTOBJ/version.o \
		OPTOBJ/homogfactor.o OPTOBJ/debug.o
OPTFACTOROBJ2 =	OPTOBJ/tmpl_inst.o
OPTFACTOROBJ =	$(OPTFACTOROBJ2) $(OPTFACTOROBJ1)

OPTCHARSETOBJ =	OPTOBJ/csutil.o OPTOBJ/charset.o OPTOBJ/reorder.o \
		OPTOBJ/alg_factor.o OPTOBJ/algfactor.o

DEBFACTOROBJ1 =	DEBOBJ/SqrFree.o DEBOBJ/Factor.o DEBOBJ/MVMultiHensel.o \
		DEBOBJ/Truefactor.o DEBOBJ/helpstuff.o DEBOBJ/version.o \
		DEBOBJ/homogfactor.o DEBOBJ/debug.o
DEBFACTOROBJ2 =	DEBOBJ/tmpl_inst.o
DEBFACTOROBJ = 	$(DEBFACTOROBJ2) $(DEBFACTOROBJ1)

DEBCHARSETOBJ =	DEBOBJ/csutil.o DEBOBJ/charset.o DEBOBJ/reorder.o \
		DEBOBJ/alg_factor.o DEBOBJ/algfactor.o

##
## Primary targets
##

.SUFFIXES:      .cc .h .o

all: OPTOBJ DEBOBJ ${TARGETNAME}

OPTOBJ:
	${MKINSTALLDIRS} OPTOBJ

DEBOBJ:
	${MKINSTALLDIRS} DEBOBJ

OPTOBJ/%.o: %.cc
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

OPTOBJ/%.o: charset/%.cc
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

OPTOBJ/%.o: factor/%.cc
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

OPTOBJ/tmpl_inst.o: factor/tmpl_inst.cc
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

DEBOBJ/%.o: %.cc
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

DEBOBJ/%.o: charset/%.cc
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

DEBOBJ/%.o: factor/%.cc
	$(CXX) $(CXXFLAGS) $(CXXTEMPLFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@

DEBOBJ/tmpl_inst.o: factor/tmpl_inst.cc
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(DEFS) -c $< -o $@


libfac:		libfac.a

libsingfac:	libsingfac.a

libfac-g:	libfac-g.a

libsingfac-g:	libsingfac-g.a

libfac.a:	$(OPTFACTOROBJ) $(OPTCHARSETOBJ)
		$(AR) ${LIBFACNAME}.a $(OPTFACTOROBJ) $(OPTCHARSETOBJ)
		$(RANLIB) ${LIBFACNAME}.a

libsingfac.a:	$(OPTFACTOROBJ1) $(OPTCHARSETOBJ)
		$(AR) ${SINGLIBFACNAME}.a $(OPTFACTOROBJ1) $(OPTCHARSETOBJ)
		$(RANLIB) ${SINGLIBFACNAME}.a

libfac-g.a:	$(DEBFACTOROBJ) $(DEBCHARSETOBJ)
		$(AR) ${LIBFACNAME}.a $(DEBFACTOROBJ) $(DEBCHARSETOBJ)
		$(RANLIB) ${LIBFACNAME}.a

libsingfac-g.a:	$(DEBFACTOROBJ1) $(DEBCHARSETOBJ)
		$(AR) ${SINGLIBFACNAME}.a $(DEBFACTOROBJ1) $(DEBCHARSETOBJ)
		$(RANLIB) ${SINGLIBFACNAME}.a

install-nolns: install

install:	all
	${MKINSTALLDIRS} ${includedir}
	${MKINSTALLDIRS} ${libdir}
	${INSTALL_DATA} ${LIBFACINCLUDE} ${includedir}
	${INSTALL_PROGRAM} ${TARGETNAME}.a ${libdir}
	$(RANLIB) ${libdir}/${TARGETNAME}.a

uninstall:
	$(RM) ${includedir}/${LIBFACINCLUDE}
	$(RM) ${libdir}/${LIBFACNAME}.a
	$(RM) ${libdir}/${SINGLIBFACNAME}.a

mostlyclean:
	$(RM)	test testcs ${LIBFACNAME}.a ${SINGLIBFACNAME}.a \
		${LIBFACNAME-G}.a ${SINGLIBFACNAME-G}.a

clean:	mostlyclean
	$(RM) OPTOBJ/optdepend DEBOBJ/debdepend  \
	      DEBOBJ/*.o OPTOBJ/*.o

distclean:	clean
	$(RM) config.cache config.log config.status Makefile

dist:	distclean
	$(RM) ../libfac-${LIBFACVERSION}.tgz
	(cd .. ; gtar -zcvf libfac-${LIBFACVERSION}.tgz libfac-${LIBFACVERSION})

########## From here on: Only for internal use!
#################################################

factest:	libfac OPTOBJ/test.o
		$(CXX) -o test $(LDFLAGS) OPTOBJ/test.o $(LIBS)

factests:	factest
		(cd tests ; factortest )

charsettest:	libfac	OPTOBJ/testcs.o
		$(CXX) -o testcs $(LDFLAGS) OPTOBJ/testcs.o $(LIBS)

#charsettests:	charsettest
#		(cd tests ; charsettest )

tests:		factests

